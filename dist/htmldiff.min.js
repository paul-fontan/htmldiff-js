module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";n.r(t);var r={equal:0,delete:1,insert:2,none:3,replace:4};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.startInOld=t,this.startInNew=n,this.size=r}var t,n,r;return t=e,(n=[{key:"endInOld",get:function(){return this.startInOld+this.size}},{key:"endInNew",get:function(){return this.startInNew+this.size}}])&&i(t.prototype,n),r&&i(t,r),e}();var o=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.blockSize=0,this.repeatingWordsAccuracy=0,this.ignoreWhitespaceDifferences=!1},a=/^\s*<\/?[^>]+>\s*$/,c=/<[^\s>]+/,l=/^(\s|&nbsp;)+$/,u=/[\w\#@]+/,h=["<img"];function d(e){return!h.some(function(t){return null!==e&&e.startsWith(t)})&&a.test(e)}function f(e,t,n){return["<",t,' class="',n,'">',e,"</",t,">"].join("")}function p(e){return"<"===e}function w(e){return"&"===e}function v(e){return";"===e}function g(e){return l.test(e)}function y(e){return d(e)?function(e){return e=c.exec(e)[0]+(e.endsWith("/>")?"/>":">")}(e):e}function I(e){return u.test(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,t,n){return e.push(t),e.length>n&&e.shift(),e.length!==n?null:e.join("")}var k=function(){function e(t,n,r,i,s,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.oldWords=t,this.newWords=n,this.startInOld=r,this.endInOld=i,this.startInNew=s,this.endInNew=o,this.options=a}var t,n,r;return t=e,(n=[{key:"indexNewWords",value:function(){this.wordIndices=new Map;for(var e=[],t=this.startInNew;t<this.endInNew;t++){var n=W(e,this.normalizeForIndex(this.newWords[t]),this.options.blockSize);null!==n&&(this.wordIndices.has(n)?this.wordIndices.get(n).push(t):this.wordIndices.set(n,[t]))}}},{key:"normalizeForIndex",value:function(e){return e=y(e),this.options.IgnoreWhiteSpaceDifferences&&g(e)?" ":e}},{key:"findMatch",value:function(){if(this.indexNewWords(),this.removeRepeatingWords(),0===this.wordIndices.length)return null;for(var e=this.startInOld,t=this.startInNew,n=0,r=new Map,i=this.options.blockSize,o=[],a=this.startInOld;a<this.endInOld;a++){var c=W(o,this.normalizeForIndex(this.oldWords[a]),i);if(null!==c){var l=new Map;if(this.wordIndices.has(c)){var u=!0,h=!1,d=void 0;try{for(var f,p=this.wordIndices.get(c)[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var w=f.value,v=(r.has(w-1)?r.get(w-1):0)+1;l.set(w,v),v>n&&(e=a-v-i+2,t=w-v-i+2,n=v)}}catch(e){h=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(h)throw d}}r=l}else r=l}}return 0!==n?new s(e,t,n+i-1):null}},{key:"removeRepeatingWords",value:function(){var e=this.newWords.length+this.options.repeatingWordsAccuracy,t=Array.from(this.wordIndices.entries()).filter(function(t){return t[1].length>e}).map(function(e){return e[0]}),n=!0,r=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value;this.wordIndices.delete(a)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}}])&&b(t.prototype,n),r&&b(t,r),e}();var x=function e(t,n,r,i,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=t,this.startInOld=n,this.endInOld=r,this.startInNew=i,this.endInNew=s},m={character:0,tag:1,whitespace:2,entity:3};function O(e,t){for(var n={mode:m.character,currentWord:[],words:[]},r=function(e,t){var n=new Map;if(null===t)return n;var r=!0,i=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0)for(var c=o.value,l=void 0;null!==(l=c.exec(e));){if(n.has(l.index))throw new Error("One or more block expressions result in a text sequence that overlaps. Current expression: "+c.toString());n.set(l.index,l.index+l[0].length)}}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return n}(e,t),i=!!r.size,s=!1,o=-1,a=0;a<e.length;a++){var c=e[a];if(i){o===index&&(o=-1,s=!1);if(r.has(index)&&(s=!0,o=r.get(index)),s){n.currentWord.push(c),n.mode=m.character;continue}}switch(n.mode){case m.character:p(c)?N(n,"<",m.tag):w(c)?N(n,c,m.entity):g(c)?N(n,c,m.whitespace):I(c)&&(0===n.currentWord.length||I(n.currentWord[n.currentWord.length-1]))?n.currentWord.push(c):N(n,c,m.character);break;case m.tag:">"===c?(n.currentWord.push(c),n.words.push(n.currentWord.join("")),n.currentWord=[],n.mode=g(c)?m.whitespace:m.character):n.currentWord.push(c);break;case m.whitespace:p(c)?N(n,c,m.tag):w(c)?N(n,c,m.entity):g(c)?n.currentWord.push(c):N(n,c,m.character);break;case m.entity:if(p(c))N(n,c,m.tag);else if(g(c))N(n,c,m.whitespace);else if(v(c)){var l=!0;if(0!==n.currentWord.length&&(n.currentWord.push(c),n.words.push(n.currentWord.join("")),n.words.length>2&&g(n.words[n.words.length-2])&&g(n.words[n.words.length-1]))){var u=n.words[n.words.length-2],h=n.words[n.words.length-1];n.words.splice(n.words.length-2,2),n.currentWord=[(u+h).split()],n.mode=m.whitespace,l=!1}l&&(n.currentWord=[],n.mode=m.character)}else I(c)?n.currentWord.push(c):N(n,c,m.character)}}return 0!==n.currentWord.length&&n.words.push(n.currentWord.join("")),n.words}function N(e,t,n){0!==e.currentWord.length&&e.words.push(e.currentWord.join("")),e.currentWord=[t],e.mode=n}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=new Map([["</strong>",0],["</em>",0],["</b>",0],["</i>",0],["</big>",0],["</small>",0],["</u>",0],["</sub>",0],["</strike>",0],["</s>",0]]),j=/<((strong)|(b)|(i)|(em)|(big)|(small)|(u)|(sub)|(sup)|(strike)|(s))[\>\s]+/gi,M=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.content=[],this.newText=n,this.oldText=t,this.specialTagDiffStack=[],this.newWords=[],this.oldWords=[],this.matchGranularity=0,this.blockExpressions=[],this.repeatingWordsAccuracy=1,this.ignoreWhiteSpaceDifferences=!1,this.orphanMatchThreshold=0}var t,n,i;return t=e,(n=[{key:"build",value:function(){if(this.oldText===this.newText)return this.newText;this.splitInputsIntoWords(),this.matchGranularity=Math.min(4,this.oldWords.length,this.newWords.length);var e=this.operations(),t=!0,n=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var o=i.value;this.performOperation(o)}}catch(e){n=!0,r=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw r}}return this.content.join("")}},{key:"addBlockExpression",value:function(e){this.blockExpressions.push(e)}},{key:"splitInputsIntoWords",value:function(){this.oldWords=O(this.oldText,this.blockExpressions),this.oldText=null,this.newWords=O(this.newText,this.blockExpressions),this.newText=null}},{key:"performOperation",value:function(e){switch(e.action){case r.equal:this.processEqualOperation(e);break;case r.delete:this.processDeleteOperation(e,"diffdel");break;case r.insert:this.processInsertOperation(e,"diffins");break;case r.none:break;case r.replace:this.processReplaceOperation(e)}}},{key:"processReplaceOperation",value:function(e){this.processDeleteOperation(e,"diffmod"),this.processInsertOperation(e,"diffmod")}},{key:"processInsertOperation",value:function(e,t){var n=this.newWords.filter(function(t,n){return n>=e.startInNew&&n<e.endInNew});this.insertTag("ins",t,n)}},{key:"processDeleteOperation",value:function(e,t){var n=this.oldWords.filter(function(t,n){return n>=e.startInOld&&n<e.endInOld});this.insertTag("del",t,n)}},{key:"processEqualOperation",value:function(e){var t=this.newWords.filter(function(t,n){return n>=e.startInNew&&n<e.endInNew});this.content.push(t.join(""))}},{key:"insertTag",value:function(e,t,n){for(;n.length;){var r=this.extractConsecutiveWords(n,function(e){return!d(e)}),i="",s=!1;if(0!==r.length){var o=f(r.join(""),e,t);this.content.push(o)}else{if(j.test(n[0])){if(this.specialTagDiffStack.push(n[0]),i='<ins class="mod">',"del"===e)for(n.shift();n.length>0&&j.test(n[0]);)n.shift()}else if(S.has(n[0])){var a=0===this.specialTagDiffStack.length?null:this.specialTagDiffStack.pop();if(null!==a&&a===n[0].replace(/\//g,"")&&(i="</ins>",s=!0),"del"===e)for(n.shift();n.length>0&&S.has(n[0]);)n.shift()}if(0===n.length&&0===i.length)break;s?this.content.push(i+this.extractConsecutiveWords(n,d).join("")):this.content.push(this.extractConsecutiveWords(n,d).join("")+i)}}}},{key:"extractConsecutiveWords",value:function(e,t){for(var n=null,r=0;r<e.length;r++){var i=e[r];if(0===r&&" "===i&&(e[r]="&nbsp;"),!t(i)){n=r;break}}if(null!==n){var s=e.filter(function(e,t){return t>=0&&t<n});return n>0&&e.splice(0,n),s}var o=e.filter(function(t,n){return n>=0&&n<e.length});return e.splice(0,e.length),o}},{key:"operations",value:function(){var e=0,t=0,n=[],i=this.matchingBlocks();i.push(new s(this.oldWords.length,this.newWords.length,0));var o=this.removeOrphans(i),a=!0,c=!1,l=void 0;try{for(var u,h=o[Symbol.iterator]();!(a=(u=h.next()).done);a=!0){var d=u.value,f=e===d.startInOld,p=t===d.startInNew,w=void 0;(w=f||p?f&&!p?r.insert:f?r.none:r.delete:r.replace)!==r.none&&n.push(new x(w,e,d.startInOld,t,d.startInNew)),0!==d.length&&n.push(new x(r.equal,d.startInOld,d.endInOld,d.startInNew,d.endInNew)),e=d.endInOld,t=d.endInNew}}catch(e){c=!0,l=e}finally{try{a||null==h.return||h.return()}finally{if(c)throw l}}return n}},{key:"removeOrphans",value:regeneratorRuntime.mark(function e(t){var n,r,i,o,a,c,l,u,h,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=null,r=null,i=!0,o=!1,a=void 0,e.prev=5,c=t[Symbol.iterator]();case 7:if(i=(l=c.next()).done){e.next=31;break}if(u=l.value,null!==r){e.next=13;break}return n=new s(0,0,0),r=u,e.abrupt("continue",28);case 13:if(!(n.endInOld===r.startInOld&&n.endInNew===r.startInNew||r.endInOld===u.startInOld&&r.endInNew===u.startInNew)){e.next=19;break}return e.next=16,r;case 16:return n=r,r=u,e.abrupt("continue",28);case 19:if(h=function(e,t){return e+t.length},d=this.oldWords.slice(n.endInOld,u.startInOld).reduce(h,0),f=this.newWords.slice(n.endInNew,u.startInNew).reduce(h,0),!(this.newWords.slice(r.startInNew,r.endInNew).reduce(h,0)>Math.max(d,f)*this.orphanMatchThreshold)){e.next=26;break}return e.next=26,r;case 26:n=r,r=u;case 28:i=!0,e.next=7;break;case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(5),o=!0,a=e.t0;case 37:e.prev=37,e.prev=38,i||null==c.return||c.return();case 40:if(e.prev=40,!o){e.next=43;break}throw a;case 43:return e.finish(40);case 44:return e.finish(37);case 45:return e.next=47,r;case 47:case"end":return e.stop()}},e,this,[[5,33,37,45],[38,,40,44]])})},{key:"matchingBlocks",value:function(){var e=[];return this.findMatchingBlocks(0,this.oldWords.length,0,this.newWords.length,e),e}},{key:"findMatchingBlocks",value:function(e,t,n,r,i){var s=this.findMatch(e,t,n,r);null!==s&&(e<s.startInOld&&n<s.startInNew&&this.findMatchingBlocks(e,s.startInOld,n,s.startInNew,i),i.push(s),s.endInOld<t&&s.endInNew<r&&this.findMatchingBlocks(s.endInOld,t,s.endInNew,r,i))}},{key:"findMatch",value:function(e,t,n,r){for(var i=this.matchGranularity;i>0;i--){var s=new o;s.blockSize=i,s.repeatingWordsAccuracy=this.repeatingWordsAccuracy,s.ignoreWhitespaceDifferences=this.ignoreWhiteSpaceDifferences;var a=new k(this.oldWords,this.newWords,e,t,n,r,s).findMatch();if(null!==a)return a}return null}}])&&T(t.prototype,n),i&&T(t,i),e}();M.execute=function(e,t){return new M(e,t).build()};t.default=M}]);